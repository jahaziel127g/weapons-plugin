<html>
<head>
<title>WeaponsListener.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
WeaponsListener.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span><span class="s1">me</span><span class="s2">.</span><span class="s1">jahaziel</span><span class="s2">.</span><span class="s1">weapons</span><span class="s2">.</span><span class="s1">events</span><span class="s2">;</span>

<span class="s0">import </span><span class="s1">me</span><span class="s2">.</span><span class="s1">jahaziel</span><span class="s2">.</span><span class="s1">weapons</span><span class="s2">.</span><span class="s1">WeaponsPlugin</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">me</span><span class="s2">.</span><span class="s1">jahaziel</span><span class="s2">.</span><span class="s1">weapons</span><span class="s2">.</span><span class="s1">items</span><span class="s2">.</span><span class="s1">CustomItems</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">me</span><span class="s2">.</span><span class="s1">jahaziel</span><span class="s2">.</span><span class="s1">weapons</span><span class="s2">.</span><span class="s1">managers</span><span class="s2">.</span><span class="s1">CooldownManager</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">org</span><span class="s2">.</span><span class="s1">bukkit</span><span class="s2">.</span><span class="s1">Bukkit</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">org</span><span class="s2">.</span><span class="s1">bukkit</span><span class="s2">.</span><span class="s1">Location</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">org</span><span class="s2">.</span><span class="s1">bukkit</span><span class="s2">.</span><span class="s1">Particle</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">org</span><span class="s2">.</span><span class="s1">bukkit</span><span class="s2">.</span><span class="s1">Sound</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">org</span><span class="s2">.</span><span class="s1">bukkit</span><span class="s2">.</span><span class="s1">attribute</span><span class="s2">.</span><span class="s1">Attribute</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">org</span><span class="s2">.</span><span class="s1">bukkit</span><span class="s2">.</span><span class="s1">entity</span><span class="s2">.*;</span>
<span class="s0">import </span><span class="s1">org</span><span class="s2">.</span><span class="s1">bukkit</span><span class="s2">.</span><span class="s1">event</span><span class="s2">.</span><span class="s1">EventHandler</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">org</span><span class="s2">.</span><span class="s1">bukkit</span><span class="s2">.</span><span class="s1">event</span><span class="s2">.</span><span class="s1">Listener</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">org</span><span class="s2">.</span><span class="s1">bukkit</span><span class="s2">.</span><span class="s1">event</span><span class="s2">.</span><span class="s1">entity</span><span class="s2">.</span><span class="s1">EntityDamageByEntityEvent</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">org</span><span class="s2">.</span><span class="s1">bukkit</span><span class="s2">.</span><span class="s1">event</span><span class="s2">.</span><span class="s1">player</span><span class="s2">.</span><span class="s1">PlayerInteractEvent</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">org</span><span class="s2">.</span><span class="s1">bukkit</span><span class="s2">.</span><span class="s1">inventory</span><span class="s2">.</span><span class="s1">EquipmentSlot</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">org</span><span class="s2">.</span><span class="s1">bukkit</span><span class="s2">.</span><span class="s1">inventory</span><span class="s2">.</span><span class="s1">ItemStack</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">org</span><span class="s2">.</span><span class="s1">bukkit</span><span class="s2">.</span><span class="s1">potion</span><span class="s2">.</span><span class="s1">PotionEffect</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">org</span><span class="s2">.</span><span class="s1">bukkit</span><span class="s2">.</span><span class="s1">potion</span><span class="s2">.</span><span class="s1">PotionEffectType</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">org</span><span class="s2">.</span><span class="s1">bukkit</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">Vector</span><span class="s2">;</span>

<span class="s0">import </span><span class="s1">java</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">UUID</span><span class="s2">;</span>

<span class="s0">public class </span><span class="s1">WeaponsListener </span><span class="s0">implements </span><span class="s1">Listener </span><span class="s2">{</span>
    <span class="s0">private final </span><span class="s1">WeaponsPlugin plugin</span><span class="s2">;</span>

    <span class="s0">public </span><span class="s1">WeaponsListener</span><span class="s2">(</span><span class="s1">WeaponsPlugin plugin</span><span class="s2">) { </span><span class="s0">this</span><span class="s2">.</span><span class="s1">plugin </span><span class="s2">= </span><span class="s1">plugin</span><span class="s2">; }</span>

    <span class="s1">@EventHandler</span>
    <span class="s0">public void </span><span class="s1">onEntityDamage</span><span class="s2">(</span><span class="s1">EntityDamageByEntityEvent e</span><span class="s2">) {</span>
        <span class="s0">if </span><span class="s2">(!(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">getDamager</span><span class="s2">() </span><span class="s0">instanceof </span><span class="s1">Player player</span><span class="s2">)) </span><span class="s0">return</span><span class="s2">;</span>
        <span class="s1">ItemStack weapon </span><span class="s2">= </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getInventory</span><span class="s2">().</span><span class="s1">getItemInMainHand</span><span class="s2">();</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">weapon </span><span class="s2">== </span><span class="s0">null</span><span class="s2">) </span><span class="s0">return</span><span class="s2">;</span>

        <span class="s1">String id </span><span class="s2">= </span><span class="s1">CustomItems</span><span class="s2">.</span><span class="s1">getId</span><span class="s2">(</span><span class="s1">weapon</span><span class="s2">);</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">id </span><span class="s2">== </span><span class="s0">null</span><span class="s2">) </span><span class="s0">return</span><span class="s2">;</span>

        <span class="s3">// SCYTHE OF LIGHT — mace-like hits but sword cooldown</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">id</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s4">&quot;scythe_of_light&quot;</span><span class="s2">)) {</span>
            <span class="s1">e</span><span class="s2">.</span><span class="s1">setDamage</span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">getDamage</span><span class="s2">() + </span><span class="s5">3.0</span><span class="s2">);</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">getEntity</span><span class="s2">() </span><span class="s0">instanceof </span><span class="s1">LivingEntity tgt</span><span class="s2">) {</span>
                <span class="s1">Location p </span><span class="s2">= </span><span class="s1">tgt</span><span class="s2">.</span><span class="s1">getLocation</span><span class="s2">().</span><span class="s1">add</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">);</span>
                <span class="s3">// replaced removed ITEM_CRACK with END_ROD for sparkle</span>
                <span class="s1">tgt</span><span class="s2">.</span><span class="s1">getWorld</span><span class="s2">().</span><span class="s1">spawnParticle</span><span class="s2">(</span><span class="s1">Particle</span><span class="s2">.</span><span class="s1">END_ROD</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">);</span>
                <span class="s1">tgt</span><span class="s2">.</span><span class="s1">getWorld</span><span class="s2">().</span><span class="s1">playSound</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">Sound</span><span class="s2">.</span><span class="s1">ENTITY_PLAYER_ATTACK_SWEEP</span><span class="s2">, </span><span class="s5">0.8f</span><span class="s2">, </span><span class="s5">1f</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">// SCYTHE OF DARKNESS — reaping (pull) on hit</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">id</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s4">&quot;scythe_of_darkness&quot;</span><span class="s2">)) {</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">getEntity</span><span class="s2">() </span><span class="s0">instanceof </span><span class="s1">LivingEntity tgt</span><span class="s2">) {</span>
                <span class="s1">Vector pull </span><span class="s2">= </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getLocation</span><span class="s2">().</span><span class="s1">toVector</span><span class="s2">().</span><span class="s1">subtract</span><span class="s2">(</span><span class="s1">tgt</span><span class="s2">.</span><span class="s1">getLocation</span><span class="s2">().</span><span class="s1">toVector</span><span class="s2">()).</span><span class="s1">normalize</span><span class="s2">().</span><span class="s1">multiply</span><span class="s2">(</span><span class="s5">1.6</span><span class="s2">);</span>
                <span class="s1">tgt</span><span class="s2">.</span><span class="s1">setVelocity</span><span class="s2">(</span><span class="s1">pull</span><span class="s2">);</span>
                <span class="s3">// shadow particle using CAMPFIRE_COSY_SMOKE (stable)</span>
                <span class="s1">tgt</span><span class="s2">.</span><span class="s1">getWorld</span><span class="s2">().</span><span class="s1">spawnParticle</span><span class="s2">(</span><span class="s1">Particle</span><span class="s2">.</span><span class="s1">CAMPFIRE_COSY_SMOKE</span><span class="s2">, </span><span class="s1">tgt</span><span class="s2">.</span><span class="s1">getLocation</span><span class="s2">().</span><span class="s1">add</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s5">8</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.02</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">// LIFESTEALER — heal 50% of damage dealt</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">id</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s4">&quot;lifestealer&quot;</span><span class="s2">)) {</span>
            <span class="s0">double </span><span class="s1">heal </span><span class="s2">= </span><span class="s1">e</span><span class="s2">.</span><span class="s1">getFinalDamage</span><span class="s2">() * </span><span class="s5">0.5</span><span class="s2">;</span>
            <span class="s0">double </span><span class="s1">max </span><span class="s2">= </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getAttribute</span><span class="s2">(</span><span class="s1">Attribute</span><span class="s2">.</span><span class="s1">GENERIC_MAX_HEALTH</span><span class="s2">).</span><span class="s1">getValue</span><span class="s2">();</span>
            <span class="s1">player</span><span class="s2">.</span><span class="s1">setHealth</span><span class="s2">(</span><span class="s1">Math</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">player</span><span class="s2">.</span><span class="s1">getHealth</span><span class="s2">() + </span><span class="s1">heal</span><span class="s2">, </span><span class="s1">max</span><span class="s2">));</span>
            <span class="s3">// use END_ROD + HEART instead of ITEM_CRACK</span>
            <span class="s1">player</span><span class="s2">.</span><span class="s1">getWorld</span><span class="s2">().</span><span class="s1">spawnParticle</span><span class="s2">(</span><span class="s1">Particle</span><span class="s2">.</span><span class="s1">HEART</span><span class="s2">, </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getLocation</span><span class="s2">().</span><span class="s1">add</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s5">6</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">);</span>
            <span class="s1">player</span><span class="s2">.</span><span class="s1">getWorld</span><span class="s2">().</span><span class="s1">spawnParticle</span><span class="s2">(</span><span class="s1">Particle</span><span class="s2">.</span><span class="s1">END_ROD</span><span class="s2">, </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getLocation</span><span class="s2">().</span><span class="s1">add</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s5">8</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">// WITHER LAUNCHER — backup on-hit effect</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">id</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s4">&quot;wither_launcher&quot;</span><span class="s2">)) {</span>
            <span class="s0">if </span><span class="s2">(!</span><span class="s1">CooldownManager</span><span class="s2">.</span><span class="s1">isOnCooldown</span><span class="s2">(</span><span class="s4">&quot;wither_launcher&quot;</span><span class="s2">, </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getUniqueId</span><span class="s2">())) {</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">getEntity</span><span class="s2">() </span><span class="s0">instanceof </span><span class="s1">LivingEntity tgt</span><span class="s2">) {</span>
                    <span class="s1">tgt</span><span class="s2">.</span><span class="s1">addPotionEffect</span><span class="s2">(</span><span class="s0">new </span><span class="s1">PotionEffect</span><span class="s2">(</span><span class="s1">PotionEffectType</span><span class="s2">.</span><span class="s1">WITHER</span><span class="s2">, </span><span class="s5">20 </span><span class="s2">* </span><span class="s5">20</span><span class="s2">, </span><span class="s5">0</span><span class="s2">));</span>
                    <span class="s1">player</span><span class="s2">.</span><span class="s1">addPotionEffect</span><span class="s2">(</span><span class="s0">new </span><span class="s1">PotionEffect</span><span class="s2">(</span><span class="s1">PotionEffectType</span><span class="s2">.</span><span class="s1">WITHER</span><span class="s2">, </span><span class="s5">20 </span><span class="s2">* </span><span class="s5">10</span><span class="s2">, </span><span class="s5">0</span><span class="s2">));</span>
                    <span class="s1">CooldownManager</span><span class="s2">.</span><span class="s1">setCooldown</span><span class="s2">(</span><span class="s4">&quot;wither_launcher&quot;</span><span class="s2">, </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getUniqueId</span><span class="s2">(), </span><span class="s5">30L</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s1">@EventHandler</span>
    <span class="s0">public void </span><span class="s1">onPlayerInteract</span><span class="s2">(</span><span class="s1">PlayerInteractEvent e</span><span class="s2">) {</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">getHand</span><span class="s2">() != </span><span class="s1">EquipmentSlot</span><span class="s2">.</span><span class="s1">HAND</span><span class="s2">) </span><span class="s0">return</span><span class="s2">;</span>
        <span class="s1">Player player </span><span class="s2">= </span><span class="s1">e</span><span class="s2">.</span><span class="s1">getPlayer</span><span class="s2">();</span>
        <span class="s1">ItemStack item </span><span class="s2">= </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getInventory</span><span class="s2">().</span><span class="s1">getItemInMainHand</span><span class="s2">();</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">item </span><span class="s2">== </span><span class="s0">null</span><span class="s2">) </span><span class="s0">return</span><span class="s2">;</span>
        <span class="s1">String id </span><span class="s2">= </span><span class="s1">CustomItems</span><span class="s2">.</span><span class="s1">getId</span><span class="s2">(</span><span class="s1">item</span><span class="s2">);</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">id </span><span class="s2">== </span><span class="s0">null</span><span class="s2">) </span><span class="s0">return</span><span class="s2">;</span>

        <span class="s1">UUID uuid </span><span class="s2">= </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getUniqueId</span><span class="s2">();</span>

        <span class="s3">// SCYTHE OF DARKNESS — right-click wave that transfers potion effects &amp; costs 25% health</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">id</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s4">&quot;scythe_of_darkness&quot;</span><span class="s2">)) {</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">CooldownManager</span><span class="s2">.</span><span class="s1">isOnCooldown</span><span class="s2">(</span><span class="s4">&quot;scythe_dark_wave&quot;</span><span class="s2">, </span><span class="s1">uuid</span><span class="s2">)) {</span>
                <span class="s1">player</span><span class="s2">.</span><span class="s1">sendMessage</span><span class="s2">(</span><span class="s4">&quot;§cScythe wave on cooldown (&quot; </span><span class="s2">+ </span><span class="s1">CooldownManager</span><span class="s2">.</span><span class="s1">getRemaining</span><span class="s2">(</span><span class="s4">&quot;scythe_dark_wave&quot;</span><span class="s2">, </span><span class="s1">uuid</span><span class="s2">) + </span><span class="s4">&quot;s)&quot;</span><span class="s2">);</span>
                <span class="s0">return</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">Location eye </span><span class="s2">= </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getEyeLocation</span><span class="s2">();</span>
            <span class="s1">Vector dir </span><span class="s2">= </span><span class="s1">eye</span><span class="s2">.</span><span class="s1">getDirection</span><span class="s2">().</span><span class="s1">normalize</span><span class="s2">();</span>

            <span class="s3">// visual: feather trail replaced with END_ROD + CAMPFIRE_COSY_SMOKE</span>
            <span class="s0">for </span><span class="s2">(</span><span class="s0">int </span><span class="s1">i </span><span class="s2">= </span><span class="s5">1</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt;= </span><span class="s5">6</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                <span class="s1">Location p </span><span class="s2">= </span><span class="s1">eye</span><span class="s2">.</span><span class="s1">clone</span><span class="s2">().</span><span class="s1">add</span><span class="s2">(</span><span class="s1">dir</span><span class="s2">.</span><span class="s1">clone</span><span class="s2">().</span><span class="s1">multiply</span><span class="s2">(</span><span class="s1">i</span><span class="s2">));</span>
                <span class="s1">p</span><span class="s2">.</span><span class="s1">getWorld</span><span class="s2">().</span><span class="s1">spawnParticle</span><span class="s2">(</span><span class="s1">Particle</span><span class="s2">.</span><span class="s1">CAMPFIRE_COSY_SMOKE</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.02</span><span class="s2">);</span>
                <span class="s1">p</span><span class="s2">.</span><span class="s1">getWorld</span><span class="s2">().</span><span class="s1">spawnParticle</span><span class="s2">(</span><span class="s1">Particle</span><span class="s2">.</span><span class="s1">END_ROD</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s3">// affect targets</span>
            <span class="s0">for </span><span class="s2">(</span><span class="s1">Entity ent </span><span class="s2">: </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getNearbyEntities</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)) {</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">ent </span><span class="s0">instanceof </span><span class="s1">LivingEntity tgt </span><span class="s2">&amp;&amp; !</span><span class="s1">tgt</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s1">player</span><span class="s2">)) {</span>
                    <span class="s1">tgt</span><span class="s2">.</span><span class="s1">damage</span><span class="s2">(</span><span class="s5">6</span><span class="s2">, </span><span class="s1">player</span><span class="s2">);</span>
                    <span class="s3">// transfer potion effects</span>
                    <span class="s0">for </span><span class="s2">(</span><span class="s1">PotionEffect eff </span><span class="s2">: </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getActivePotionEffects</span><span class="s2">()) {</span>
                        <span class="s1">tgt</span><span class="s2">.</span><span class="s1">addPotionEffect</span><span class="s2">(</span><span class="s0">new </span><span class="s1">PotionEffect</span><span class="s2">(</span><span class="s1">eff</span><span class="s2">.</span><span class="s1">getType</span><span class="s2">(), </span><span class="s1">eff</span><span class="s2">.</span><span class="s1">getDuration</span><span class="s2">(), </span><span class="s1">eff</span><span class="s2">.</span><span class="s1">getAmplifier</span><span class="s2">()));</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s3">// cost player 25% health</span>
            <span class="s0">double </span><span class="s1">cost </span><span class="s2">= </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s5">1.0</span><span class="s2">, </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getHealth</span><span class="s2">() * </span><span class="s5">0.25</span><span class="s2">);</span>
            <span class="s1">player</span><span class="s2">.</span><span class="s1">damage</span><span class="s2">(</span><span class="s1">cost</span><span class="s2">);</span>
            <span class="s1">CooldownManager</span><span class="s2">.</span><span class="s1">setCooldown</span><span class="s2">(</span><span class="s4">&quot;scythe_dark_wave&quot;</span><span class="s2">, </span><span class="s1">uuid</span><span class="s2">, </span><span class="s5">10L</span><span class="s2">);</span>

            <span class="s3">// cosmetic: sound and title</span>
            <span class="s1">player</span><span class="s2">.</span><span class="s1">playSound</span><span class="s2">(</span><span class="s1">player</span><span class="s2">.</span><span class="s1">getLocation</span><span class="s2">(), </span><span class="s1">Sound</span><span class="s2">.</span><span class="s1">ENTITY_ELDER_GUARDIAN_CURSE</span><span class="s2">, </span><span class="s5">1f</span><span class="s2">, </span><span class="s5">1f</span><span class="s2">);</span>
            <span class="s1">player</span><span class="s2">.</span><span class="s1">sendTitle</span><span class="s2">(</span><span class="s4">&quot;§5Dark Wave&quot;</span><span class="s2">, </span><span class="s4">&quot;§7You feel the shadows consume you&quot;</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">40</span><span class="s2">, </span><span class="s5">5</span><span class="s2">);</span>
            <span class="s0">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">// LIFESTEALER right-click: temporary absorption hearts</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">id</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s4">&quot;lifestealer&quot;</span><span class="s2">)) {</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">CooldownManager</span><span class="s2">.</span><span class="s1">isOnCooldown</span><span class="s2">(</span><span class="s4">&quot;lifestealer_m2&quot;</span><span class="s2">, </span><span class="s1">uuid</span><span class="s2">)) {</span>
                <span class="s1">player</span><span class="s2">.</span><span class="s1">sendMessage</span><span class="s2">(</span><span class="s4">&quot;§cLifestealer on cooldown&quot;</span><span class="s2">);</span>
                <span class="s0">return</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">player</span><span class="s2">.</span><span class="s1">addPotionEffect</span><span class="s2">(</span><span class="s0">new </span><span class="s1">PotionEffect</span><span class="s2">(</span><span class="s1">PotionEffectType</span><span class="s2">.</span><span class="s1">ABSORPTION</span><span class="s2">, </span><span class="s5">20 </span><span class="s2">* </span><span class="s5">30</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)); </span><span class="s3">// stronger absorption</span>
            <span class="s1">player</span><span class="s2">.</span><span class="s1">getWorld</span><span class="s2">().</span><span class="s1">spawnParticle</span><span class="s2">(</span><span class="s1">Particle</span><span class="s2">.</span><span class="s1">END_ROD</span><span class="s2">, </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getLocation</span><span class="s2">().</span><span class="s1">add</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s5">20</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">);</span>
            <span class="s1">player</span><span class="s2">.</span><span class="s1">playSound</span><span class="s2">(</span><span class="s1">player</span><span class="s2">.</span><span class="s1">getLocation</span><span class="s2">(), </span><span class="s1">Sound</span><span class="s2">.</span><span class="s1">ENTITY_PLAYER_LEVELUP</span><span class="s2">, </span><span class="s5">1f</span><span class="s2">, </span><span class="s5">1.2f</span><span class="s2">);</span>
            <span class="s1">CooldownManager</span><span class="s2">.</span><span class="s1">setCooldown</span><span class="s2">(</span><span class="s4">&quot;lifestealer_m2&quot;</span><span class="s2">, </span><span class="s1">uuid</span><span class="s2">, </span><span class="s5">60L</span><span class="s2">);</span>
            <span class="s0">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">// WITHER LAUNCHER right-click: spawn wither skull (non-destructive)</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">id</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s4">&quot;wither_launcher&quot;</span><span class="s2">)) {</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">CooldownManager</span><span class="s2">.</span><span class="s1">isOnCooldown</span><span class="s2">(</span><span class="s4">&quot;wither_launcher&quot;</span><span class="s2">, </span><span class="s1">uuid</span><span class="s2">)) {</span>
                <span class="s1">player</span><span class="s2">.</span><span class="s1">sendMessage</span><span class="s2">(</span><span class="s4">&quot;§cWither Launcher on cooldown&quot;</span><span class="s2">);</span>
                <span class="s0">return</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">Location spawn </span><span class="s2">= </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getEyeLocation</span><span class="s2">().</span><span class="s1">add</span><span class="s2">(</span><span class="s1">player</span><span class="s2">.</span><span class="s1">getLocation</span><span class="s2">().</span><span class="s1">getDirection</span><span class="s2">());</span>
            <span class="s1">WitherSkull skull </span><span class="s2">= </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getWorld</span><span class="s2">().</span><span class="s1">spawn</span><span class="s2">(</span><span class="s1">spawn</span><span class="s2">, </span><span class="s1">WitherSkull</span><span class="s2">.</span><span class="s0">class</span><span class="s2">);</span>
            <span class="s1">skull</span><span class="s2">.</span><span class="s1">setShooter</span><span class="s2">(</span><span class="s1">player</span><span class="s2">);</span>
            <span class="s1">skull</span><span class="s2">.</span><span class="s1">setVelocity</span><span class="s2">(</span><span class="s1">player</span><span class="s2">.</span><span class="s1">getLocation</span><span class="s2">().</span><span class="s1">getDirection</span><span class="s2">().</span><span class="s1">multiply</span><span class="s2">(</span><span class="s5">1.6</span><span class="s2">));</span>
            <span class="s1">skull</span><span class="s2">.</span><span class="s1">setIsIncendiary</span><span class="s2">(</span><span class="s0">false</span><span class="s2">);</span>

            <span class="s3">// visual trail around launch (END_ROD)</span>
            <span class="s1">player</span><span class="s2">.</span><span class="s1">getWorld</span><span class="s2">().</span><span class="s1">spawnParticle</span><span class="s2">(</span><span class="s1">Particle</span><span class="s2">.</span><span class="s1">END_ROD</span><span class="s2">, </span><span class="s1">spawn</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">);</span>
            <span class="s1">player</span><span class="s2">.</span><span class="s1">playSound</span><span class="s2">(</span><span class="s1">player</span><span class="s2">.</span><span class="s1">getLocation</span><span class="s2">(), </span><span class="s1">Sound</span><span class="s2">.</span><span class="s1">ENTITY_WITHER_SHOOT</span><span class="s2">, </span><span class="s5">1f</span><span class="s2">, </span><span class="s5">0.9f</span><span class="s2">);</span>

            <span class="s3">// when skull 'hits' apply wither effects and remove skull (delayed simulate)</span>
            <span class="s1">Bukkit</span><span class="s2">.</span><span class="s1">getScheduler</span><span class="s2">().</span><span class="s1">runTaskLater</span><span class="s2">(</span><span class="s1">WeaponsPlugin</span><span class="s2">.</span><span class="s1">getInstance</span><span class="s2">(), () </span><span class="s1">-&gt; </span><span class="s2">{</span>
                <span class="s0">for </span><span class="s2">(</span><span class="s1">Entity ent </span><span class="s2">: </span><span class="s1">skull</span><span class="s2">.</span><span class="s1">getNearbyEntities</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)) {</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">ent </span><span class="s0">instanceof </span><span class="s1">LivingEntity t</span><span class="s2">) </span><span class="s1">t</span><span class="s2">.</span><span class="s1">addPotionEffect</span><span class="s2">(</span><span class="s0">new </span><span class="s1">PotionEffect</span><span class="s2">(</span><span class="s1">PotionEffectType</span><span class="s2">.</span><span class="s1">WITHER</span><span class="s2">, </span><span class="s5">20 </span><span class="s2">* </span><span class="s5">20</span><span class="s2">, </span><span class="s5">1</span><span class="s2">));</span>
                <span class="s2">}</span>
                <span class="s1">player</span><span class="s2">.</span><span class="s1">addPotionEffect</span><span class="s2">(</span><span class="s0">new </span><span class="s1">PotionEffect</span><span class="s2">(</span><span class="s1">PotionEffectType</span><span class="s2">.</span><span class="s1">WITHER</span><span class="s2">, </span><span class="s5">20 </span><span class="s2">* </span><span class="s5">10</span><span class="s2">, </span><span class="s5">1</span><span class="s2">));</span>
                <span class="s1">skull</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">();</span>
            <span class="s2">}, </span><span class="s5">12L</span><span class="s2">);</span>

            <span class="s1">CooldownManager</span><span class="s2">.</span><span class="s1">setCooldown</span><span class="s2">(</span><span class="s4">&quot;wither_launcher&quot;</span><span class="s2">, </span><span class="s1">uuid</span><span class="s2">, </span><span class="s5">30L</span><span class="s2">);</span>
            <span class="s0">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">// KING'S CROWN cosmetic sparkle when right-clicking while wearing</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">id</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s4">&quot;kings_crown&quot;</span><span class="s2">)) {</span>
            <span class="s1">player</span><span class="s2">.</span><span class="s1">getWorld</span><span class="s2">().</span><span class="s1">spawnParticle</span><span class="s2">(</span><span class="s1">Particle</span><span class="s2">.</span><span class="s1">END_ROD</span><span class="s2">, </span><span class="s1">player</span><span class="s2">.</span><span class="s1">getLocation</span><span class="s2">().</span><span class="s1">add</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1.2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s5">6</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
<span class="s2">}</span>
</pre>
</body>
</html>